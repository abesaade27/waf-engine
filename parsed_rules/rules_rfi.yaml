- id: "930170"
  name: LFI / OS File Access â€“ Safe with Dynamic Upload Whitelist
  variable: REQUEST_URI_RAW|ARGS|REQUEST_HEADERS|FILES|XML:/*
  # Detect ../ or .../ sequences in paths, sensitive OS files, or unsafe uploaded filenames
  regex: '(?i)(?:^|[\x5c/;])\.{2,3}[\x5c/;]|(?:/etc/passwd|/etc/shadow|/etc/hosts|/boot/grub/grub\.cfg|/var/log/auth\.log|/var/log/syslog|/proc/\d+/cmdline|C:\\Windows\\system32\\drivers\\etc\\hosts|C:\\Windows\\win\.ini|C:\\Windows\\System32\\config\\SAM)'
  phase: 2
  severity: CRITICAL
  block: true
  transforms:
    - utf8toUnicode
    - urlDecodeUni
    - removeNulls
    - cmdLine
    - normalizePathWin
  tags:
    - application-multi
    - language-multi
    - platform-multi
    - attack-lfi
    - paranoia-level/1
    - OWASP_CRS
    - OWASP_CRS/ATTACK-LFI
    - capec/1000/255/153/126
  # Context-specific exclusions to reduce false positives
  exclusions:
    - FILES:!DYNAMIC_WHITELIST        # Dynamic whitelist for safe uploaded filenames
    - ARGS:!JSON_SAFE_KEYS            # Only ignore harmless JSON keys (e.g., "csrf_token", "session_id")
    - XML:!VALUE                       # Ignore safe XML values


- id: "930130"
  name: Restricted File Access Attempt
  variable: REQUEST_FILENAME
  regex: '@pmFromFile restricted-files.data'
  phase: 1
  severity: CRITICAL
  block: true
  transforms:
    - none
    - utf8toUnicode
    - urlDecodeUni
    - normalizePathWin
  tags:
    - application-multi
    - language-multi
    - platform-multi
    - attack-lfi
    - paranoia-level/1
    - OWASP_CRS
    - OWASP_CRS/ATTACK-LFI
    - capec/1000/255/153/126
- id: "930121"
  name: OS File Access Attempt in REQUEST_HEADERS
  variable: REQUEST_HEADERS:Referer|REQUEST_HEADERS:User-Agent
  regex: '@pmFromFile lfi-os-files.data'
  phase: 1
  severity: CRITICAL
  block: true
  transforms:
    - none
    - utf8toUnicode
    - urlDecodeUni
    - normalizePathWin
  tags:
    - application-multi
    - language-multi
    - platform-multi
    - attack-lfi
    - paranoia-level/2
    - OWASP_CRS
    - OWASP_CRS/ATTACK-LFI
    - capec/1000/255/153/126
